<head>
	<!-- Load plotly.js into the DOM -->
	<script src='https://cdn.plot.ly/plotly-latest.min.js'></script>
</head>

<body>
	<div id='myDiv'><!-- Plotly chart will be drawn inside this DIV --></div>
</body>

<script>
Plotly.d3.csv(
	//"https://raw.githubusercontent.com/plotly/datasets/master/2015_06_30_precipitation.csv",
	"./mapariesgo.csv",
	function(err, rows) {
		function unpack(rows, key) {
			return rows.map(function(row) {
				return row[key];
			});
		}

		var rho7 = unpack(rows, "rho7");
		var ia14 = unpack(rows, "ia14");
		var EPG = unpack(rows, "producto");
		var textos=unpack(rows, "Texto");		
		
		var maxEPG=0;
		for(var i=0;i<EPG.length;i++){
			if(maxEPG<EPG[i]) maxEPG=EPG[i];
			textos[i]=textos[i]+", EPG="+EPG[i]+", rho7="+rho7[i]+", ia14="+ia14[i]		
		} 
		for(var i=0;i<EPG.length;i++) EPG[i]=EPG[i]*5.0/maxEPG;
		
		var data = [
			{
			//nombre1,rho7,ia14,producto,nombre2,Latitud,Longitud,Texto

				type: "scattermapbox",
				text: textos,
				lon: unpack(rows, "Longitud"),
				lat: unpack(rows, "Latitud"),
				marker: { color: "red", size: 8.0 }
			}
		];

		var layout = {
			dragmode: "zoom",
			//mapbox: { style: "open-street-map", center: { lat: 38, lon: -90 }, zoom: 3 },
			mapbox: { style: "open-street-map", center: { lat: -36.620922, lon: -64.2912369}, zoom: 3 },
			margin: { r: 0, t: 0, b: 0, l: 0 },
			showlegend: false,
		};


		Plotly.newPlot("myDiv", data, layout);
	}
);
</script>
